<div class="relative z-0 flex flex-col flex-1 lg:overflow-hidden h-full">
    <!-- Trips Filters -->
    <div class="flex  justify-between items-start gap-4 px-4 sm:px-6 lg:px-8 py-2 mt-2">
      <div class="flex flex-wrap gap-2 items-center">
        <form class="flex flex-wrap gap-2 items-top" [formGroup]="searchForm">
          <!-- Trip ID -->
          <div>
            <input formControlName="search_tripId" type="text" name="search" id="search" placeholder="Trip ID" />
            <div *ngIf="submitted && form.search_tripId.errors" class="invalid-feedback m-l-10">
              <div *ngIf="form.search_tripId.errors.required">
                <p class="mt-2 text-xs text-main-danger ">
                  Trip ID is required
                </p>
              </div>
            </div>
          </div>
  
          <!-- Member Name -->
          <div>
            <input formControlName="search_name" type="text" name="search" id="search" placeholder="Member" />
            <div *ngIf="submitted && form.search_name.errors" class="invalid-feedback m-l-10">
              <div *ngIf="form.search_name.errors.required">
                <p class="mt-2 text-xs text-main-danger ">
                  Name is required
                </p>
              </div>
            </div>
          </div>
  
          <!-- Datepicker -->
          <div class="relative w-full flex-shrink sm:w-auto">
            <div class="relative">
              <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3" aria-hidden="true">
                <svg class="h-5 w-5 text-main-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                  stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5m-9-6h.008v.008H12v-.008zM12 15h.008v.008H12V15zm0 2.25h.008v.008H12v-.008zM9.75 15h.008v.008H9.75V15zm0 2.25h.008v.008H9.75v-.008zM7.5 15h.008v.008H7.5V15zm0 2.25h.008v.008H7.5v-.008zm6.75-4.5h.008v.008h-.008v-.008zm0 2.25h.008v.008h-.008V15zm0 2.25h.008v.008h-.008v-.008zm2.25-4.5h.008v.008H16.5v-.008zm0 2.25h.008v.008H16.5V15z" />
                </svg>
              </div>
              <!-- [(ngModel)]="todayDate" (ngModelChange)="onDateChange($event)" -->
              <input #date type="text" class="form-control" formControlName="search_date" placeholder="Date"
                [owlDateTimeTrigger]="dt2" [owlDateTime]="dt2" readonly="true" />
              <owl-date-time [pickerType]="'both'" #dt2></owl-date-time>
            </div>
            <div *ngIf="submitted && form.search_date.errors" class="invalid-feedback m-l-10">
              <div *ngIf="form.search_date.errors.required">
                <p class="mt-2 text-xs text-main-danger ">
                  Date is required
                </p>
              </div>
            </div>
          </div>
  
          <!-- Phone Number -->
          <div>
            <input formControlName="search_phone" type="text" name="search" id="search" placeholder="Phone" />
            <div *ngIf="submitted && form.search_phone.errors" class="invalid-feedback m-l-10">
              <div *ngIf="form.search_phone.errors.required">
                <p class="mt-2 text-xs text-main-danger ">
                  Phone is required
                </p>
              </div>
            </div>
          </div>
  
          <!-- Company  -->
          <div>
            <select [(ngModel)]="searchCompanyType" [ngModelOptions]="{standalone: true}" (ngModelChange)="changeC()" id="companies" class="form-control">
              <option value="">-- All Companies --</option>
              <option *ngFor="let company of companies | sortBy:'asc':'displayName'" value="{{ company._id }}">
                {{ company.displayName }}
              </option>
            </select>
          </div>
  
          <!-- Search Button -->
          <div>
            <button type="button" (click)="onSubmit()"
              class="btn-primary text-xs">Search</button>
          </div>
  
          <!-- Clear Button -->
          <div>
            <button type="button" class="btn-white text-xs" (click)=clearSearch()>Clear</button>
          </div>
        </form>
      </div>
  
      <!-- Filters -->
      <div class="flex items-center gap-2">
        <!-- Additional Filters (Dropdown) -->
        <div (outsideClick)="closeFilter()" outside-click
          class="p-1 border rounded-md border-main-base cursor-pointer shadow relative">
          <span *ngIf="searchBroker || searchStatus || isAnyColumnToggled()" class="flex absolute h-3 w-3 -top-1 -right-1">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 bg-main-danger"></span>
            <span class="relative inline-flex rounded-full h-3 w-3 bg-main-danger"></span>
          </span>
          <div (click)="showFilter()" class="p-1 text-main-secondary">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" />
  
            </svg>
          </div>
          <div *ngIf="showSlideFilter "
            class="absolute -right-40 md:right-0 z-20 cursor-auto select-none mt-3 w-72 origin-top-eight rounded-md bg-header-base shadow-lg ring-1 ring-main-base focus:outline-none p-4 "
            role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
            <div class="space-y-4">
              <!-- Broker -->
              <select [(ngModel)]="searchBroker" (change)="onChangeDropdownFilters()" id="brokers" class="form-control">
                <option value="">-- All Brokers --</option>
                <option *ngFor="let broker of (companyTypes | keyvalue) | sortBy:'asc':'value'" value="{{ broker.key }}">
                  {{ broker.value }}
                </option>
              </select>
  
              <!-- Status -->
              <select [(ngModel)]="searchStatus" (change)="onChangeDropdownFilters()" class="form-control">
                <option value=""><a> -- All Status --</a></option>
                <option value="accepted"><a>Accepted</a></option>
                <option value="unassigned"><a>Unassigned</a></option>
                <option value="finished"><a>Finished</a></option>
                <option value="offered"><a>Offered</a></option>
                <option value="marketplaced"><a>Marketplaced</a></option>
                <option value="returned"><a>Returned</a></option>
                <option value="archived"><a>Archived</a></option>
                <option value="cancelled"><a>Cancelled</a></option>
                <option value="declined"><a>Declined</a></option>
                <option value="inprogress"><a>Inprogress</a></option>
                <option value="bumped"><a>Bumped</a></option>
                <option value="expired"><a>Expired</a></option>
                <option value="onway"><a>Onway</a></option>
              </select>
  
              <!-- Toggle Table Column -->
              <div *ngIf="filteredAssigns && filteredAssigns.length">
                <div class="mb-1">
                  <label for="medical-trip"
                      class="cursor-pointer leading-6 text-header-light hover:text-header-hover-light group flex items-center text-sm">
                        Toggle Table Columns
                  </label>
                </div>
                <div class="grid grid-cols-2 gap-2 border border-gray-300 p-2 rounded-md">
                  <div class="relative flex items-center">
                    <div (click)="setColumnVisibility('name')" class="flex h-6 items-center">
                      <input [(ngModel)]="columns.name" id="name" name="name" type="checkbox"
                        class="h-4 w-4 rounded border-gray-300 checked:bg-main-primary checked:ring-2 checked:ring-main-primary" />
                      <label (click)="setColumnVisibility('name')" for="name"
                        class="ml-3 cursor-pointer leading-6 text-header-light hover:text-header-hover-light group flex items-center text-sm">
                        Name
                      </label>
                    </div>
                  </div>
                  <div class="relative flex items-center">
                    <div (click)="setColumnVisibility('address')" class="flex h-6 items-center">
                      <input [(ngModel)]="columns.address" id="address" name="address" type="checkbox"
                        class="h-4 w-4 rounded border-gray-300 checked:bg-main-primary checked:ring-2 checked:ring-main-primary" />
                      <label (click)="setColumnVisibility('address')" for="address"
                        class="ml-3 cursor-pointer leading-6 text-header-light hover:text-header-hover-light group flex items-center text-sm">
                        Address
                      </label>
                    </div>
                  </div>
                  <div class="relative flex items-center">
                    <div (click)="setColumnVisibility('miles')" class="flex h-6 items-center">
                      <input [(ngModel)]="columns.miles" id="miles" name="miles" type="checkbox"
                        class="h-4 w-4 rounded border-gray-300 checked:bg-main-primary checked:ring-2 checked:ring-main-primary" />
                      <label (click)="setColumnVisibility('miles')" for="miles"
                        class="ml-3 cursor-pointer leading-6 text-header-light hover:text-header-hover-light group flex items-center text-sm">
                        Miles
                      </label>
                    </div>
                  </div>
                  <div class="relative flex items-center">
                    <div (click)="setColumnVisibility('vehicle')" class="flex h-6 items-center">
                      <input [(ngModel)]="columns.vehicle" id="vehicle" name="vehicle" type="checkbox"
                        class="h-4 w-4 rounded border-gray-300 checked:bg-main-primary checked:ring-2 checked:ring-main-primary" />
                      <label (click)="setColumnVisibility('vehicle')" for="vehicle"
                        class="ml-3 cursor-pointer leading-6 text-header-light hover:text-header-hover-light group flex items-center text-sm">
                        Vehicle
                      </label>
                    </div>
                  </div>
                  <div class="relative flex items-center">
                    <div (click)="setColumnVisibility('provider')" class="flex h-6 items-center">
                      <input [(ngModel)]="columns.provider" id="provider" name="provider" type="checkbox"
                        class="h-4 w-4 rounded border-gray-300 checked:bg-main-primary checked:ring-2 checked:ring-main-primary" />
                      <label (click)="setColumnVisibility('provider')" for="provider"
                        class="ml-3 cursor-pointer leading-6 text-header-light hover:text-header-hover-light group flex items-center text-sm">
                        Provider
                      </label>
                    </div>
                  </div>
                  <div class="relative flex items-center">
                    <div (click)="setColumnVisibility('status')" class="flex h-6 items-center">
                      <input [(ngModel)]="columns.status" id="status" name="status" type="checkbox"
                        class="h-4 w-4 rounded border-gray-300 checked:bg-main-primary checked:ring-2 checked:ring-main-primary" />
                      <label (click)="setColumnVisibility('status')" for="status"
                        class="ml-3 cursor-pointer leading-6 text-header-light hover:text-header-hover-light group flex items-center text-sm">
                        Status
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
  
        <!-- View Selection (List/Grid) -->
        <div class="flex items-center border rounded-md border-main-base shadow p-1 gap-1">
          <div [ngClass]="view === 'grid' ? 'bg-main-primary text-white' : 'bg-white text-main-secondary'"
            (click)="view = 'grid'" class="p-1 rounded cursor-pointer">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" />
            </svg>
          </div>
          <div [ngClass]="view === 'list' ? 'bg-main-primary text-white' : 'bg-white text-main-secondary'"
            (click)="view = 'list'" class="p-1 rounded cursor-pointer">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M3.75 5.25h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5" />
            </svg>
          </div>
        </div>
      </div>
    </div>
  
    <!-- List View -->
    <div class="flex-1 overflow-hidden px-4 sm:px-6 lg:px-8" *ngIf="view === 'list'">
      <div class="my-4 flex flex-col h-full -mx-4 sm:-mx-6 lg:-mx-8">
        <div class="-my-2 overflow-x-auto h-full">
          <div class="inline-block min-w-full py-2 align-middle h-full">
            <div class="overflow-x-hidden shadow ring-1 ring-main-base min-h-full">
              <table class="min-w-full divide-y divide-main-base">
                <thead class="bg-main-base-50">
                  <tr>          
                    <th scope="col" class="px-2 py-3 text-left text-xs font-semibold text-main-dark">
                      Trip ID
                    </th>
                    <th *ngIf="columns.name" scope="col" class="px-2 py-3 text-left text-xs font-semibold text-main-dark">
                      Name
                    </th>
                    <th *ngIf="columns.address" scope="col" class="px-2 py-3 text-left text-xs font-semibold text-main-dark">
                      PU - DO Address
                    </th>
                    <th *ngIf="columns.miles" scope="col" class="px-2 py-3 text-left text-xs font-semibold text-main-dark">
                      Miles
                    </th>
                    <th *ngIf="columns.vehicle" scope="col" class="px-2 py-3 text-left text-xs font-semibold text-main-dark">
                      Vehicle
                    </th>
                    <th *ngIf="columns.provider" scope="col" class="px-2 py-3 text-left text-xs font-semibold text-main-dark">
                      Provider
                    </th>
                    <th *ngIf="columns.provider" scope="col" class="px-2 py-3 text-left text-xs font-semibold text-main-dark">
                      Broker
                    </th>
                    <th *ngIf="columns.status" scope="col" class="px-2 py-3 text-left text-xs font-semibold text-main-dark">
                      Status
                    </th>
                    <th scope="col" class="px-2 py-3 text-left text-xs font-semibold text-main-dark">
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-main-base bg-white">
                  <!-- *ngFor="let assign of filterdataList | filter : search | filter : selectedBroker | filterByKey: 'assign.driver._id': selectedDriver | filterByKey: 'assign.tripRequirement': selectedVehicle; let i = index" -->
                  <tr *ngFor="let assign of filteredAssigns; let i = index">
                    <!-- Checkbox -->
                    <td *ngIf="false" class="relative w-12 px-6 sm:w-16 sm:px-8">
                      <!-- Selected row marker, only show when row is selected. -->
                      <div class="absolute inset-y-0 left-0 w-0.5 bg-main-primary"
                        [ngClass]="{'hidden': !assign.isSelected}"></div>
                        <!-- (click)="onSelectTrip(assign)" -->
                      <input  type="checkbox" [(ngModel)]="assign.isSelected"
                        type="checkbox" class="absolute left-4 top-1/2 -mt-2 sm:left-6" />
                    </td>
  
                    <!-- Trip ID -->
                    <td class="whitespace-nowrap px-2 py-2 text-xs text-main-light">
                      <div class="text-main-light">{{ assign.tripId }}</div>
                      <!-- style="font-size: 0.875rem;color: #5d9cec;margin-left: 5px;cursor: pointer;" -->
                      <div *ngIf="assign.driver && !assign.driver.profileImageURL" (click)="fetchDriver(assign)"
                        class="cursor-pointer text-blue-400">
                        Fetch Driver
                      </div>
                      <div *ngIf="assign.driver && assign.driver.profileImageURL" class="flex items-center gap-2">
                        <a href="javascript:void(0);" class="pull-left">
                          <img alt="" src="{{assign.driver.profileImageURL ||'assets/images/users/avatar-2.jpg'}}"
                            class="h-7 w-7 rounded-full">
                        </a>
                        <div class="">
                          <span>{{assign.driver.displayName}}</span>
                        </div>
                      </div>
                    </td>
  
                    <!-- Member Info -->
                    <td *ngIf="columns.name" class="whitespace-nowrap px-2 py-2 text-xs text-main-light">
                      <div>
                        <div class="font-medium text-main-dark">
                          {{ (assign.priorityClient.displayName | capitalize) || 'N/A' }}
                        </div>
                        <div class="text-main-light">{{ assign.priorityClient.contactNumber }}</div>
                      </div>
                    </td>
  
                    <!-- PU/DO Address -->
                    <td *ngIf="columns.address" class="px-2 py-2 text-xs text-main-light">
                      <!-- w-64 -->
                      <div class="flex flex-col w-72">
                        <!-- PU -->
                        <div class="relative pb-2">
                          <span
                            class="absolute inset-y-0 mt-1 left-2 ml-px h-full w-0.5 border border-dashed border-main-light"
                            aria-hidden="true"></span>
                          <div class="relative flex items-start gap-x-2">
                            <div
                              class="h-5 w-5 bg-container-base rounded-full overflow-hidden grid place-content-center flex-shrink-0">
                              <svg class="w-4 h-4 text-main-success" fill="none" stroke="currentColor" stroke-width="1.5"
                                viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path _ngcontent-iwt-c16="" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" stroke-linecap="round"
                                  stroke-linejoin="round"></path>
                                <path _ngcontent-iwt-c16=""
                                  d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"
                                  stroke-linecap="round" stroke-linejoin="round"></path>
                              </svg>
                            </div>
                            <div>
                              <div class="text-main-secondary">
                                {{assign.jobOriginAddress}}
                              </div>
                              <div *ngIf="companiesByKey && companiesByKey[assign['company']]" class="text-main-light">
                                {{ assign.scheduleTime | date: "" : companiesByKey[assign.company].timeZone }}
                                <span class="text-xs ml-1 text-blue-400">
                                  (CT: {{providerTime | date: "MM/DD/YYYY HH:mm": companiesByKey[assign.company].timeZone }})
                                </span>
                              </div>
                            </div>
                          </div>
                        </div>
  
                        <!-- DO -->
                        <div class="relative">
                          <div class="relative flex items-start gap-x-2">
                            <div
                              class="h-5 w-5 bg-container-base rounded-full overflow-hidden grid place-content-center flex-shrink-0">
                              <svg class="w-4 h-4 text-main-danger" fill="none" stroke="currentColor" stroke-width="1.5"
                                viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path _ngcontent-iwt-c16="" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" stroke-linecap="round"
                                  stroke-linejoin="round"></path>
                                <path _ngcontent-iwt-c16=""
                                  d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"
                                  stroke-linecap="round" stroke-linejoin="round"></path>
                              </svg>
                            </div>
                            <div>
                              <div class="text-main-secondary">
                                {{assign.jobDestinationAddress}}
                              </div>
                              <div *ngIf="companiesByKey && companiesByKey[assign['company']]" class="text-main-light">
                                {{assign.appointmentTime | date: "" : companiesByKey[assign.company].timeZone}}
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </td>
  
                    <!-- Miles -->
                    <td *ngIf="columns.miles" class="whitespace-nowrap px-2 py-2 text-xs text-main-light">
                      {{ assign.milage || "N/A" }} mi
                    </td>
  
                    <!-- Vehicle -->
                    <td *ngIf="columns.vehicle" class="whitespace-nowrap px-2 py-2 text-xs text-main-light">
                      {{ assign.tripRequirement | uppercase }}
                    </td>
  
                    <!-- Provider -->
                    <td *ngIf="columns.provider" class="whitespace-nowrap px-2 py-2 text-xs text-main-light">
                      <ng-container *ngIf="companiesByKey && companiesByKey[assign['company']]">
                        {{ companiesByKey[assign.company].displayName | uppercase }}
                        <p class="m-0 p-0 font-600">
                          ({{ companiesByKey[assign.company].timeZone }})
                        </p>
                      </ng-container>
                    </td>
  
                    <!-- Broker -->
                    <td class="whitespace-nowrap px-2 py-2 text-xs text-main-light">
                      <span *ngIf="assign.jobType !== 'cooperate' &&  assign.companyType === ''">Cab Dispatch</span>
                      <span *ngIf="assign.jobType !== 'cooperate' &&  assign.companyType && assign.companyType.length">
                        {{companyTypes[assign.companyType]}}</span>
                      <span *ngIf="assign.jobType === 'cooperate'">Corporate</span>
                    </td>
  
                    <!-- Status -->
                    <td *ngIf="columns.status" class="whitespace-nowrap px-2 py-2 text-xs text-main-light">
                      <!-- {{
                      (assign.jobStatus === "pending"
                      ? "Unassigned"
                      : assign.jobStatus === "arrived"
                      ? "On Scene"
                      : assign.jobStatus === "started"
                      ? "Member Onboard"
                      : assign.jobStatus
                      ) | uppercase
                      }} -->
  
                      {{
                        ((assign.status | titlecase) + ' ('+ ((assign.jobStatus === "pending"
                        ? "Unassigned"
                        : assign.jobStatus === "arrived"
                        ? "On Scene"
                        : assign.jobStatus === "started"
                        ? "Member Onboard"
                        : assign.jobStatus) | titlecase) +
                        ')')
                      }}
                    </td>
  
                    <!-- Actions -->
                    <td class="relative whitespace-nowrap py-2 pl-2 pr-4 text-right text-xs font-medium sm:pr-6">
                      <div id="toggle-action-div1-{{i}}" class="flex justify-end divide-x items-center divide-main-base">
                        <div id="toggle-action-div2-{{i}}" class="inline-flex relative">
                          <a href="javascript:void(0)" id="toggle-action-anchor-{{i}}" (click)="showActionButtons(i)"
                            class="px-2 text-main-primary hover:text-main-primary-hover duration-500 ease-linear">
                            <svg id="toggle-action-menu-svg-{{i}}" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                              stroke="currentColor" class="w-5 h-5">
                              <path stroke-linecap="round" stroke-linejoin="round"
                                d="M12 6.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 12.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 18.75a.75.75 0 110-1.5.75.75 0 010 1.5z" />
                            </svg>
                          </a>
                          <div (outsideClick)="closeActionMenu($event)" outside-click
                            *ngIf="selectedDropdownIndex === i && toggleActionButtons"
                            class="absolute right-4 z-20 my-4 w-64 origin-top-right rounded-md bg-header-base shadow-lg ring-1 ring-main-base focus:outline-none"
                            role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
                            <app-trip-actions-dropdown class="divide-y divide-main-base" [assign]="assign"
                              (markReady)="updateJob(assign, 'isReadyForPickup')"
                              (markVip)="updateJob(assign, 'isVipTrip')"
                              (markConfirmed)="updateJob(assign, 'isConfirmedTrip')"
                              (markVoicemail)="updateJob(assign, 'isVoiceMail')" 
                              (tripDetails)="viewTripDetails(assign)">
                            </app-trip-actions-dropdown>
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Grid View -->
    <div class="px-4 sm:px-6 lg:px-8 py-4 overflow-y-auto" *ngIf="view === 'grid'">
      <div class="flex flex-wrap justify-between items-center gap-4">
      </div>
      <div class="mt-4 grid md:grid-cols-2 xl:grid-cols-3 gap-6">
        <div class="relative" *ngFor="let assign of filteredAssigns; let i = index">
          <div
            class="mix-blend-multiply rounded-md ring-1 ring-main-base p-2 flex flex-col text-xs text-main-secondary shadow-lg">
            <!-- Trip & Member Info, & Action Dropdown -->
            <div class="flex items-start justify-between flex-wrap">
              <div class="flex flex-col">
                <div class="flex items-center gap-1">
                  <div class="text-main-primary font-bold">{{ (assign.priorityClient.displayName | capitalize) || 'N/A' }}
                  </div>
                  <!-- <div class="text-main-success font-medium">in 6 minutes</div> -->
                </div>
                <div class="text-main-light">{{ assign.tripId }}</div>
              </div>
              <div class="flex items-center gap-1">
                <span
                  class="inline-flex items-center rounded-md bg-main-primary px-1.5 py-0.5 text-[9px] font-medium text-white">
                  {{
                  (assign.jobStatus === "pending"
                  ? "Unassigned"
                  : assign.jobStatus === "arrived"
                  ? "On Scene"
                  : assign.jobStatus === "started"
                  ? "Member Onboard"
                  : assign.jobStatus
                  ) | uppercase
                  }}</span>
                <!-- <span
                                class="inline-flex items-center rounded-md bg-main-dark px-1.5 py-0.5 text-[9px] font-medium text-white">
                                Medical
                            </span> -->
                <div *ngIf="!assign.isSelected" href="javascript:void(0)" (click)="showActionButtons(i)"
                  class="px-1 py-0.5 cursor-pointer">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round"
                      d="M12 6.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 12.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 18.75a.75.75 0 110-1.5.75.75 0 010 1.5z" />
                  </svg>
                  <div (outsideClick)="closeActionMenu($event)" outside-click
                    *ngIf="selectedDropdownIndex === i && toggleActionButtons"
                    class="absolute right-4 z-20 my-4 w-64 origin-top-right rounded-md bg-header-base shadow-lg ring-1 ring-main-base focus:outline-none"
                    role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
                    <app-trip-actions-dropdown class="divide-y divide-main-base" [assign]="assign"
                      (markReady)="updateJob(assign, 'isReadyForPickup')" (markVip)="updateJob(assign, 'isVipTrip')"
                      (markConfirmed)="updateJob(assign, 'isConfirmedTrip')"
                      (markVoicemail)="updateJob(assign, 'isVoiceMail')" 
                      (tripDetails)="viewTripDetails(assign)">
                    </app-trip-actions-dropdown>
                    <!-- (clone)="cloneTrip(assign._id)" -->
                  </div>
                </div>
              </div>
            </div>
  
            <!-- PU & DO -->
            <div class="flex flex-col mt-2">
              <div class="relative">
                <div class="relative flex items-start gap-x-2">
                  <!-- <div class="h-2.5 w-2.5 rounded bg-main-danger mt-px"></div> -->
                  <div>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                      stroke="currentColor" class="w-4 h-4 text-main-success">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round"
                        d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
                    </svg>
                  </div>
                  <div>
                    <div class="text-main-secondary">
                      {{assign.jobOriginAddress}}
                    </div>
                    <div *ngIf="companiesByKey && companiesByKey[assign['company']]" class="text-main-light">
                      {{ assign.scheduleTime | date: "" : companiesByKey[assign.company].timeZone }}
                    </div>
                    <span class="text-xs ml-1 text-blue-400">
                      (CT: {{providerTime | date: "MM/DD/YYYY HH:mm": companiesByKey[assign.company].timeZone }})
                    </span>
                  </div>
                </div>
              </div>
              <div class="relative">
                <div class="relative flex items-start gap-x-2">
                  <div>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                      stroke="currentColor" class="w-4 h-4 text-main-danger">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round"
                        d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
                    </svg>
                  </div>
                  <div>
                    <div class="text-main-secondary">
                      {{assign.jobDestinationAddress}}
                    </div>
                    <div *ngIf="companiesByKey && companiesByKey[assign['company']]" class="text-main-light">
                      {{assign.appointmentTime | date: "" : companiesByKey[assign.company].timeZone}}
                    </div>
                  </div>
                </div>
              </div>
            </div>
  
            <!-- Additional Info -->
            <div class="mt-2 flex flex-col gap-2">
              <div class="flex flex-wrap items-center gap-y-2 gap-x-6">
                <div class="flex items-center gap-x-1.5">
                  <div>
                    <svg class="h-4 w-4 text-main-primary" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                      <path fill="currentColor"
                        d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01l-1.97 5.67c-.07.21-.11.43-.11.66v7.16c0 .83.67 1.5 1.5 1.5S6 20.33 6 19.5V19h12v.5c0 .82.67 1.5 1.5 1.5c.82 0 1.5-.67 1.5-1.5v-7.16c0-.22-.04-.45-.11-.66l-1.97-5.67zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5s1.5.67 1.5 1.5s-.67 1.5-1.5 1.5zM5 11l1.27-3.82c.14-.4.52-.68.95-.68h9.56c.43 0 .81.28.95.68L19 11H5z" />
                    </svg>
                  </div>
                  <div class="text-main-light">{{ assign.tripRequirement | uppercase }}</div>
                </div>
                <div class="flex items-center gap-x-1.5">
                  <div>
                    <svg class="h-4 w-4 text-main-primary" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
                      <path fill="currentColor"
                        d="M511.984 36.128C230.016 36.128.639 265.536.639 547.504c0 177.152 89.68 339.185 239.903 433.408c14.944 9.472 34.688 4.88 44.097-10.096s4.88-34.72-10.096-44.095c-54.096-33.952-99.04-78.048-133.424-128.88l33.552-19.376c15.311-8.848 20.56-28.4 11.712-43.711c-8.88-15.344-28.464-20.56-43.712-11.712l-33.6 19.391c-24.4-50.511-39.297-105.792-43.281-163.424h35.616c17.68 0 32-14.32 32-32s-14.32-32-32-32H65.95c4.24-58.687 19.776-114.304 44.56-164.592l32.16 18.56a31.745 31.745 0 0 0 15.97 4.288c11.055 0 21.807-5.744 27.743-16c8.847-15.312 3.6-34.88-11.712-43.713l-31.84-18.368c32.112-46.832 72.864-87.296 119.984-119.023l18.016 31.2c5.935 10.288 16.687 16 27.743 16a31.75 31.75 0 0 0 15.969-4.288c15.311-8.848 20.56-28.4 11.712-43.712l-17.953-31.072c49.329-23.792 103.68-38.656 160.976-42.816v39.872c0 17.68 14.32 32 32 32s32-14.32 32-32v-40c58.592 4.08 114.128 19.391 164.384 43.95l-17.36 30.049c-8.848 15.311-3.6 34.88 11.712 43.712a31.745 31.745 0 0 0 15.969 4.288c11.055 0 21.807-5.712 27.743-16l17.28-29.936a451.19 451.19 0 0 1 118.88 118.816l-29.968 17.312c-15.311 8.847-20.56 28.4-11.711 43.71c5.935 10.289 16.687 16 27.743 16c5.44 0 10.944-1.375 15.969-4.287l30.127-17.392C938.638 401.839 954 457.39 958.094 516H922.96c-17.68 0-32 14.32-32 32s14.32 32 32 32h35.12c-4.048 56.88-18.592 111.439-42.496 161.312l-31.68-18.288c-15.28-8.848-34.912-3.568-43.712 11.713c-8.848 15.311-3.6 34.88 11.712 43.712L883.68 796.8c-35.103 52.24-81.44 97.393-137.359 131.824c-15.055 9.28-19.712 29.008-10.464 44.032c6.065 9.808 16.529 15.216 27.28 15.216a31.896 31.896 0 0 0 16.753-4.752c152.464-93.904 243.472-256.784 243.472-435.632c0-281.952-229.408-511.36-511.376-511.36zm236.127 411.6c15.296-8.848 20.544-28.398 11.712-43.71c-8.832-15.296-28.416-20.544-43.712-11.696L542.287 492.674c-9.28-5.248-19.856-8.496-31.28-8.496c-35.28 0-63.84 28.591-63.84 63.807c0 35.248 28.576 63.84 63.84 63.84c35.28 0 63.84-28.592 63.84-63.84c0-.064-.016-.144-.016-.209z" />
                    </svg>
                  </div>
                  <div class="text-main-light">{{ assign.milage || "N/A" }} mi</div>
                </div>
                <div class="flex items-center gap-x-1.5">
                  <div>
                    <svg class="h-4 w-4 text-main-primary" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                      <path fill="currentColor"
                        d="M6.54 5c.06.89.21 1.76.45 2.59l-1.2 1.2c-.41-1.2-.67-2.47-.76-3.79h1.51m9.86 12.02c.85.24 1.72.39 2.6.45v1.49c-1.32-.09-2.59-.35-3.8-.75l1.2-1.19M7.5 3H4c-.55 0-1 .45-1 1c0 9.39 7.61 17 17 17c.55 0 1-.45 1-1v-3.49c0-.55-.45-1-1-1c-1.24 0-2.45-.2-3.57-.57a.84.84 0 0 0-.31-.05c-.26 0-.51.1-.71.29l-2.2 2.2a15.149 15.149 0 0 1-6.59-6.59l2.2-2.2c.28-.28.36-.67.25-1.02A11.36 11.36 0 0 1 8.5 4c0-.55-.45-1-1-1z" />
                    </svg>
                  </div>
                  <div class="text-main-light">{{ assign.priorityClient.contactNumber }}</div>
                </div>
                <!-- <div class="flex items-center gap-x-1.5">
                                <div>
                                    <svg class="h-4 w-4 text-main-primary" xmlns="http://www.w3.org/2000/svg" fill="none"
                                        viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M10.5 1.5H8.25A2.25 2.25 0 006 3.75v16.5a2.25 2.25 0 002.25 2.25h7.5A2.25 2.25 0 0018 20.25V3.75a2.25 2.25 0 00-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" />
                                    </svg>
                                </div>
                                <div class="text-main-light">6148690740</div>
                            </div> -->
                <!-- <div class="flex items-center gap-x-1.5">
                                <div>
                                    <svg class="h-4 w-4 text-main-primary" xmlns="http://www.w3.org/2000/svg"
                                        viewBox="0 0 24 24">
                                        <g fill="currentColor">
                                            <path
                                                d="M6 6a1 1 0 0 1 1-1h10a1 1 0 1 1 0 2H7a1 1 0 0 1-1-1Zm0 4a1 1 0 0 1 1-1h10a1 1 0 1 1 0 2H7a1 1 0 0 1-1-1Zm1 3a1 1 0 1 0 0 2h10a1 1 0 1 0 0-2H7Zm-1 5a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2H7a1 1 0 0 1-1-1Z" />
                                            <path fill-rule="evenodd"
                                                d="M2 4a3 3 0 0 1 3-3h14a3 3 0 0 1 3 3v16a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V4Zm3-1h14a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1Z"
                                                clip-rule="evenodd" />
                                        </g>
                                    </svg>
                                </div>
                                <div>
                                    <a href="" class="text-main-primary font-medium"> Notes </a>
                                </div>
                            </div> -->
                
                            <div class="flex items-center gap-x-1.5">
                  <div>
                    <svg class="h-4 w-4 text-main-primary" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                      <path fill="currentColor"
                        d="M10.5 15.5h3V13H16v-3h-2.5V7.5h-3V10H8v3h2.5ZM12 22q-3.475-.875-5.737-3.988Q4 14.9 4 11.1V5l8-3l8 3v6.1q0 3.8-2.262 6.912Q15.475 21.125 12 22Zm0-2.1q2.6-.825 4.3-3.3q1.7-2.475 1.7-5.5V6.375l-6-2.25l-6 2.25V11.1q0 3.025 1.7 5.5t4.3 3.3Zm0-7.9Z" />
                    </svg>
                  </div>
                  <div class="text-main-light">{{ assign.company.displayName | uppercase }}</div>
                </div>
                <div class="flex items-center gap-x-1.5">
                  <div>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                      stroke="currentColor" class="h-4 w-4 text-main-primary">
                      <path stroke-linecap="round" stroke-linejoin="round"
                        d="M12 21v-8.25M15.75 21v-8.25M8.25 21v-8.25M3 9l9-6 9 6m-1.5 12V10.332A48.36 48.36 0 0012 9.75c-2.551 0-5.056.2-7.5.582V21M3 21h18M12 6.75h.008v.008H12V6.75z" />
                    </svg>
                  </div>
                  <div *ngIf="companiesByKey && companiesByKey[assign['company']]" class="text-main-light">
                    {{ companiesByKey[assign.company].displayName }}
                  </div>
                </div>
                <!-- <div class="flex items-center gap-x-1.5">
                                <div>
                                    <svg class="h-4 w-4 text-main-primary" xmlns="http://www.w3.org/2000/svg"
                                        viewBox="0 0 24 24">
                                        <path fill="currentColor"
                                            d="M14.844 20H6.5C5.121 20 4 18.879 4 17.5S5.121 15 6.5 15h7c1.93 0 3.5-1.57 3.5-3.5S15.43 8 13.5 8H8.639a9.812 9.812 0 0 1-1.354 2H13.5c.827 0 1.5.673 1.5 1.5s-.673 1.5-1.5 1.5h-7C4.019 13 2 15.019 2 17.5S4.019 22 6.5 22h9.593a10.415 10.415 0 0 1-1.249-2zM5 2C3.346 2 2 3.346 2 5c0 3.188 3 5 3 5s3-1.813 3-5c0-1.654-1.346-3-3-3zm0 4.5a1.5 1.5 0 1 1 .001-3.001A1.5 1.5 0 0 1 5 6.5z" />
                                        <path fill="currentColor"
                                            d="M19 14c-1.654 0-3 1.346-3 3c0 3.188 3 5 3 5s3-1.813 3-5c0-1.654-1.346-3-3-3zm0 4.5a1.5 1.5 0 1 1 .001-3.001A1.5 1.5 0 0 1 19 18.5z" />
                                    </svg>
                                </div>
                                <div>
                                    <a href="" class="text-main-primary font-medium"> Fetch </a>
                                </div>
                            </div> -->
                <div *ngIf="assign.driver" class="flex items-center gap-x-1.5">
                  <div>
                    <svg class="h-4 w-4 text-main-primary" xmlns="http://www.w3.org/2000/svg" width="32" height="32"
                      viewBox="0 0 48 48">
                      <g fill="currentColor">
                        <path d="M21 11a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2h-4a1 1 0 0 1-1-1Z" />
                        <path fill-rule="evenodd"
                          d="M33.364 18.52c-.363.285-.834.513-1.402.698a8 8 0 1 1-15.924 0c-.568-.185-1.039-.413-1.401-.698c-.47-.37-.785-.864-.822-1.458c-.035-.551.183-1.019.401-1.349a4.31 4.31 0 0 1 .76-.841c.14-.123.278-.232.406-.327c-.038-.205-.08-.453-.122-.74A26.73 26.73 0 0 1 15 10c0-.314.134-.548.196-.647c.078-.125.17-.232.254-.318c.167-.175.383-.353.62-.524c.48-.348 1.14-.739 1.924-1.105C19.557 6.676 21.704 6 24 6c2.297 0 4.443.677 6.006 1.406a12.03 12.03 0 0 1 1.924 1.105c.237.171.453.35.62.524c.084.086.176.193.254.318c.062.099.196.333.196.647c0 1.602-.13 2.9-.26 3.805c-.042.287-.084.535-.122.74c.128.095.267.204.407.327c.25.219.536.504.759.841c.219.33.436.798.402 1.35c-.037.593-.352 1.087-.822 1.457Zm-16.362-8.202c.015 1.348.127 2.438.238 3.2c.026.18.052.34.076.482h13.368c.025-.142.05-.303.076-.482c.11-.762.223-1.852.238-3.2a3.886 3.886 0 0 0-.241-.188c-.361-.261-.909-.59-1.597-.911C27.777 8.573 25.924 8 24 8s-3.777.573-5.16 1.219c-.688.321-1.236.65-1.596.91a3.886 3.886 0 0 0-.242.19ZM16.788 16l-.003.002a5.03 5.03 0 0 0-.495.376c-.178.156-.32.308-.406.44a.778.778 0 0 0-.055.093a.71.71 0 0 0 .044.037c.15.118.472.291 1.1.462c.124.034.257.066.399.098l.009.002c.502.111 1.12.21 1.873.288c1.067.111 2.41.184 4.088.2L24 18c3.227 0 5.314-.201 6.62-.49l.008-.002c.143-.032.276-.064.4-.098c.627-.17.95-.344 1.099-.462a.71.71 0 0 0 .044-.037a.782.782 0 0 0-.054-.093a2.348 2.348 0 0 0-.407-.44a5.018 5.018 0 0 0-.494-.376L31.212 16H16.788Zm6.94 4c2.642 0 4.69-.14 6.26-.384a6 6 0 1 1-11.98.069c1.463.202 3.338.315 5.72.315Zm-7.65 18.877A8.07 8.07 0 0 0 16 40v1a1 1 0 0 1-1.864.504a2.99 2.99 0 0 1-2.203.259l-1.932-.518a3 3 0 0 1-2.12-3.674l.776-2.898a3 3 0 0 1 3.674-2.121l1.932.517c.672.18 1.23.575 1.618 1.091a9.987 9.987 0 0 1 8.12-4.16a9.987 9.987 0 0 1 8.116 4.158a2.987 2.987 0 0 1 1.616-1.088l1.932-.517a3 3 0 0 1 3.674 2.12l.777 2.899a3 3 0 0 1-2.122 3.674l-1.931.517a2.99 2.99 0 0 1-2.2-.256A1 1 0 0 1 32 41v-1a8.07 8.07 0 0 0-.078-1.123l-5.204 1.395a3 3 0 0 1-5.436 0l-5.204-1.395Zm5.042-.72A3.007 3.007 0 0 1 23 36.172v-4.11a8.009 8.009 0 0 0-6.397 4.886l4.517 1.21Zm10.277-1.21A8.009 8.009 0 0 0 25 32.062v4.109c.904.32 1.61 1.06 1.88 1.987l4.517-1.21Zm2.147-.72a1 1 0 0 1 .707-1.225l1.932-.518a1 1 0 0 1 1.224.707l.777 2.898a1 1 0 0 1-.707 1.225l-1.932.518a1 1 0 0 1-1.225-.708l-.776-2.897Zm-21.73-1.743a1 1 0 0 0-1.226.707l-.776 2.897a1 1 0 0 0 .707 1.225l1.932.518a1 1 0 0 0 1.225-.707l.776-2.898A1 1 0 0 0 13.745 35l-1.932-.517ZM25 39a1 1 0 1 1-2 0a1 1 0 0 1 2 0Z"
                          clip-rule="evenodd" />
                      </g>
                    </svg>
                  </div>
                  <div *ngIf="assign.driver.displayName" class="text-main-light">{{assign.driver.displayName}}</div>
                  <div *ngIf="!assign.driver.profileImageURL">
                    <a href="javascript:void(0)" (click)="fetchDriver(assign)" class="text-main-primary font-medium">Fetch Driver</a>
                  </div>
                </div>
              </div>
            </div>
  
            <!-- Actions Buttons -->
            <div class="mt-2 border-t border-main-base pt-2">
              <div class="flex flex-wrap justify-start gap-2">
                <button
                  *ngIf="assign.status === 'unassigned' || assign.status === 'accepted' || assign.status === 'offered'"
                  (click)="updateJob(assign, 'isReadyForPickup')"
                  [ngClass]="assign.isReadyForPickup ? 'btn-primary' : 'btn-white'" class="py-1 px-2 text-xs">{{assign.isReadyForPickup ? 'Un-Mark': 'Mark Ready'}}</button>
                <button (click)="viewTripDetails(assign)" class="btn-primary py-1 px-2 text-xs">Details</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <audio #audioOption>
    <source src="assets/sound/notification_bell.mp3" type="audio/mp3" />
  </audio>
  
  <app-trip-details-modal *ngIf="tripDetailObj" 
    [tripdetailModallObj]="tripDetailObj"
    (onCloseModal)="tripDetailObj = null">
  </app-trip-details-modal>




  <input [owlDateTime]="dt1" [owlDateTimeTrigger]="dt1" [(ngModel)]="todayDate" (ngModelChange)="onDateChange($event)" placeholder="Date Time">
<owl-date-time #dt1></owl-date-time>

<button (click)="showToast()">Toast</button>

<ng-multiselect-dropdown
  [placeholder]="'custom placeholder'"
  [settings]="dropdownSettings"
  [data]="dropdownList"
  [(ngModel)]="selectedItems"
  (onSelect)="onItemSelect($event)"
  (onSelectAll)="onSelectAll($event)"
>
</ng-multiselect-dropdown>
